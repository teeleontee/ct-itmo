<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span>
</span><span id="line-2"></span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE ForeignFunctionInterface
  #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-comment">{-| A binding for the native 'wcwidth'. It's important that you 'setLocale'
    before using it, like this:

 &gt;  #!/usr/bin/env runhaskell
 &gt;
 &gt;  import Text.Printf
 &gt;  
 &gt;  import System.Locale.SetLocale
 &gt;  import Data.Char.WCWidth
 &gt;
 &gt;  main                     =  do
 &gt;    setLocale LC_ALL (Just &quot;&quot;)
 &gt;    sequence_ [ display c | c &lt;- chars ]
 &gt;   where
 &gt;    chars                  =  [minBound..'A']
 &gt;    display c = printf &quot;%04x  %2d  %s\n&quot; (fromEnum c) (wcwidth c) (show c)

    The program file @WCWidthTableaux.hs@ contains a more extensive example of
    using 'wcwidth'.

    Note that this binding to the native implementation gets certain
    characters wrong in obvious ways as well as ways that are problematic for
    indentation based languages. The ASCII tab should be assigned a width of
    8, not -1; and one is likely to find -1 assigned to  numerous obscure
    characters (for example, symbols from the Book of Changes).

 -}</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span>
</span><span id="line-36"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Char.WCWidth</span><span>
</span><span id="line-37"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Data.Char.WCWidth.html#wcwidth"><span class="hs-identifier">wcwidth</span></a></span><span>
</span><span id="line-38"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Char.WCWidth.html#widths"><span class="hs-identifier">widths</span></a></span><span>
</span><span id="line-39"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Data.Char.WCWidth.html#ranges"><span class="hs-identifier">ranges</span></a></span><span>
</span><span id="line-40"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Foreign.C</span></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.List</span></span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span>
</span><span id="line-48"></span><span class="hs-comment">{-| Widths of all characters. 
 -}</span><span>
</span><span id="line-50"></span><span class="annot"><a href="Data.Char.WCWidth.html#widths"><span class="hs-identifier hs-type">widths</span></a></span><span>                      </span><span class="hs-glyph">::</span><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-51"></span><span id="widths"><span class="annot"><span class="annottext">widths :: [(Char, Int)]
</span><a href="Data.Char.WCWidth.html#widths"><span class="hs-identifier hs-var hs-var">widths</span></a></span></span><span>                       </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679025991"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
</span><a href="Data.Char.WCWidth.html#wcwidth"><span class="hs-identifier hs-var">wcwidth</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679025991"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621679025991"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621679025991"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Char
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">minBound</span></span><span class="hs-glyph">..</span><span class="annot"><span class="annottext">Char
forall a. Bounded a =&gt; a
</span><span class="hs-identifier hs-var">maxBound</span></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span> </span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>
</span><span id="line-54"></span><span class="hs-comment">{-| Characters broken into contiguous ranges with the same width.
 -}</span><span>
</span><span id="line-56"></span><span class="annot"><a href="Data.Char.WCWidth.html#ranges"><span class="hs-identifier hs-type">ranges</span></a></span><span>                      </span><span class="hs-glyph">::</span><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-57"></span><span id="ranges"><span class="annot"><span class="annottext">ranges :: [((Char, Char), Int)]
</span><a href="Data.Char.WCWidth.html#ranges"><span class="hs-identifier hs-var hs-var">ranges</span></a></span></span><span>                       </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">[((Char, Char), Int)] -&gt; [((Char, Char), Int)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">reverse</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([((Char, Char), Int)] -&gt; (Char, Int) -&gt; [((Char, Char), Int)])
-&gt; [((Char, Char), Int)] -&gt; [(Char, Int)] -&gt; [((Char, Char), Int)]
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><span class="hs-identifier hs-var">foldl'</span></span><span> </span><span class="annot"><span class="annottext">[((Char, Char), Int)] -&gt; (Char, Int) -&gt; [((Char, Char), Int)]
forall b b. Eq b =&gt; [((b, b), b)] -&gt; (b, b) -&gt; [((b, b), b)]
</span><a href="#local-6989586621679025986"><span class="hs-identifier hs-var">aggregate</span></a></span><span> </span><span class="annot"><span class="annottext">[((Char, Char), Int)]
</span><a href="#local-6989586621679025985"><span class="hs-identifier hs-var">start</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Char, Int)] -&gt; [(Char, Int)]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">tail</span></span><span> </span><span class="annot"><span class="annottext">[(Char, Int)]
</span><a href="Data.Char.WCWidth.html#widths"><span class="hs-identifier hs-var">widths</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-59"></span><span>  </span><span id="local-6989586621679025985"><span class="annot"><span class="annottext">start :: [((Char, Char), Int)]
</span><a href="#local-6989586621679025985"><span class="hs-identifier hs-var hs-var">start</span></a></span></span><span>                      </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">[((Char, Char), Int)] -&gt; (Char, Int) -&gt; [((Char, Char), Int)]
forall b b. Eq b =&gt; [((b, b), b)] -&gt; (b, b) -&gt; [((b, b), b)]
</span><a href="#local-6989586621679025986"><span class="hs-identifier hs-var">aggregate</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Char, Int)] -&gt; (Char, Int)
forall a. [a] -&gt; a
</span><span class="hs-identifier hs-var">head</span></span><span> </span><span class="annot"><span class="annottext">[(Char, Int)]
</span><a href="Data.Char.WCWidth.html#widths"><span class="hs-identifier hs-var">widths</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>  </span><span id="local-6989586621679025986"><span class="annot"><span class="annottext">aggregate :: [((b, b), b)] -&gt; (b, b) -&gt; [((b, b), b)]
</span><a href="#local-6989586621679025986"><span class="hs-identifier hs-var hs-var">aggregate</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679025982"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025982"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679025981"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025981"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025982"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025982"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025981"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><a href="#local-6989586621679025986"><span class="hs-identifier hs-var">aggregate</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621679025980"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025980"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679025979"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025979"><span class="hs-identifier hs-var">z</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679025978"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025978"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679025977"><span class="annot"><span class="annottext">[((b, b), b)]
</span><a href="#local-6989586621679025977"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679025976"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025976"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679025975"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025975"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025978"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; b -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025975"><span class="hs-identifier hs-var">w</span></a></span><span>                 </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025980"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025976"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025978"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((b, b), b) -&gt; [((b, b), b)] -&gt; [((b, b), b)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[((b, b), b)]
</span><a href="#local-6989586621679025977"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>              </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025976"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025976"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025975"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((b, b), b) -&gt; [((b, b), b)] -&gt; [((b, b), b)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025980"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025979"><span class="hs-identifier hs-var">z</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679025978"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">((b, b), b) -&gt; [((b, b), b)] -&gt; [((b, b), b)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[((b, b), b)]
</span><a href="#local-6989586621679025977"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span>
</span><span id="line-66"></span><span class="hs-comment">{-| Binding to the native 'wcwidth'. 
 -}</span><span>
</span><span id="line-68"></span><span class="annot"><a href="Data.Char.WCWidth.html#wcwidth"><span class="hs-identifier hs-type">wcwidth</span></a></span><span>                     </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-69"></span><span id="wcwidth"><span class="annot"><span class="annottext">wcwidth :: Char -&gt; Int
</span><a href="Data.Char.WCWidth.html#wcwidth"><span class="hs-identifier hs-var hs-var">wcwidth</span></a></span></span><span>                      </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">CInt -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span> </span><span class="annot"><span class="annottext">(CInt -&gt; Int) -&gt; (Char -&gt; CInt) -&gt; Char -&gt; Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">CWchar -&gt; CInt
</span><a href="Data.Char.WCWidth.html#native"><span class="hs-identifier hs-var">native</span></a></span><span> </span><span class="annot"><span class="annottext">(CWchar -&gt; CInt) -&gt; (Char -&gt; CWchar) -&gt; Char -&gt; CInt
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; CWchar
forall a. Enum a =&gt; Int -&gt; a
</span><span class="hs-identifier hs-var">toEnum</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; CWchar) -&gt; (Char -&gt; Int) -&gt; Char -&gt; CWchar
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><span class="hs-operator hs-var">.</span></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Int
forall a. Enum a =&gt; a -&gt; Int
</span><span class="hs-identifier hs-var">fromEnum</span></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-keyword">ccall</span></span><span> </span><span class="annot"><span class="hs-keyword">unsafe</span></span><span> </span><span class="annot"><span class="hs-string">&quot;wchar.h wcwidth&quot;</span></span><span> </span><span id="native"><span class="annot"><a href="Data.Char.WCWidth.html#native"><span class="hs-identifier hs-var">native</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CWchar</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">CInt</span></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span></pre></body></html>